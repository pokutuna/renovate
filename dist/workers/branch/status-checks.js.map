{"version":3,"file":"status-checks.js","sourceRoot":"","sources":["../../../lib/workers/branch/status-checks.ts"],"names":[],"mappings":";;;AACA,yCAAsC;AACtC,6CAA0C;AAC1C,uCAA2C;AAE3C,KAAK,UAAU,cAAc,CAC3B,UAAkB,EAClB,OAAe,EACf,WAAmB,EACnB,KAAmB,EACnB,GAAW;IAEX,MAAM,aAAa,GAAG,MAAM,mBAAQ,CAAC,oBAAoB,CACvD,UAAU,EACV,OAAO,CACR,CAAC;IACF,+BAA+B;IAC/B,IAAI,aAAa,KAAK,KAAK,EAAE;QAC3B,eAAM,CAAC,KAAK,CAAC,gBAAgB,OAAO,wBAAwB,CAAC,CAAC;KAC/D;SAAM;QACL,eAAM,CAAC,KAAK,CAAC,YAAY,OAAO,0BAA0B,KAAK,EAAE,CAAC,CAAC;QACnE,MAAM,mBAAQ,CAAC,eAAe,CAAC;YAC7B,UAAU;YACV,OAAO;YACP,WAAW;YACX,KAAK;YACL,GAAG;SACJ,CAAC,CAAC;KACJ;AACH,CAAC;AAOM,KAAK,UAAU,YAAY,CAAC,MAAuB;IACxD,IAAI,CAAC,MAAM,CAAC,eAAe,EAAE;QAC3B,OAAO;KACR;IACD,MAAM,OAAO,GAAG,yBAAyB,CAAC;IAC1C,MAAM,WAAW,GACf,MAAM,CAAC,eAAe,KAAK,oBAAY,CAAC,KAAK;QAC3C,CAAC,CAAC,6CAA6C;QAC/C,CAAC,CAAC,iDAAiD,CAAC;IACxD,MAAM,cAAc,CAClB,MAAM,CAAC,UAAU,EACjB,OAAO,EACP,WAAW,EACX,MAAM,CAAC,eAAe,EACtB,MAAM,CAAC,YAAY,CAAC,aAAa,CAClC,CAAC;AACJ,CAAC;AAhBD,oCAgBC;AAQM,KAAK,UAAU,gBAAgB,CACpC,MAA2B;IAE3B,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE;QACzB,OAAO;KACR;IACD,MAAM,OAAO,GAAG,yBAAyB,CAAC;IAC1C,oCAAoC;IACpC,MAAM,KAAK,GAAG,MAAM,CAAC,gBAAgB;QACnC,CAAC,CAAC,oBAAY,CAAC,MAAM;QACrB,CAAC,CAAC,oBAAY,CAAC,KAAK,CAAC;IACvB,MAAM,WAAW,GAAG,MAAM,CAAC,gBAAgB;QACzC,CAAC,CAAC,4CAA4C;QAC9C,CAAC,CAAC,gCAAgC,CAAC;IACrC,MAAM,cAAc,CAClB,MAAM,CAAC,UAAU,EACjB,OAAO,EACP,WAAW,EACX,KAAK,EACL,MAAM,CAAC,YAAY,CAAC,IAAI,CACzB,CAAC;AACJ,CAAC;AArBD,4CAqBC","sourcesContent":["import { RenovateConfig } from '../../config';\nimport { logger } from '../../logger';\nimport { platform } from '../../platform';\nimport { BranchStatus } from '../../types';\n\nasync function setStatusCheck(\n  branchName: string,\n  context: string,\n  description: string,\n  state: BranchStatus,\n  url: string\n): Promise<void> {\n  const existingState = await platform.getBranchStatusCheck(\n    branchName,\n    context\n  );\n  // Check if state needs setting\n  if (existingState === state) {\n    logger.debug(`Status check ${context} is already up-to-date`);\n  } else {\n    logger.debug(`Updating ${context} status check state to ${state}`);\n    await platform.setBranchStatus({\n      branchName,\n      context,\n      description,\n      state,\n      url,\n    });\n  }\n}\n\nexport type StabilityConfig = RenovateConfig & {\n  stabilityStatus?: BranchStatus;\n  branchName: string;\n};\n\nexport async function setStability(config: StabilityConfig): Promise<void> {\n  if (!config.stabilityStatus) {\n    return;\n  }\n  const context = `renovate/stability-days`;\n  const description =\n    config.stabilityStatus === BranchStatus.green\n      ? 'Updates have met stability days requirement'\n      : 'Updates have not met stability days requirement';\n  await setStatusCheck(\n    config.branchName,\n    context,\n    description,\n    config.stabilityStatus,\n    config.productLinks.documentation\n  );\n}\n\nexport type UnpublishableConfig = RenovateConfig & {\n  unpublishSafe?: boolean;\n  canBeUnpublished?: boolean;\n  branchName: string;\n};\n\nexport async function setUnpublishable(\n  config: UnpublishableConfig\n): Promise<void> {\n  if (!config.unpublishSafe) {\n    return;\n  }\n  const context = `renovate/unpublish-safe`;\n  // Set canBeUnpublished status check\n  const state = config.canBeUnpublished\n    ? BranchStatus.yellow\n    : BranchStatus.green;\n  const description = config.canBeUnpublished\n    ? 'Packages < 24 hours old can be unpublished'\n    : 'Packages cannot be unpublished';\n  await setStatusCheck(\n    config.branchName,\n    context,\n    description,\n    state,\n    config.productLinks.docs\n  );\n}\n"]}