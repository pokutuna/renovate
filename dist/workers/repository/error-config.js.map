{"version":3,"file":"error-config.js","sourceRoot":"","sources":["../../../lib/workers/repository/error-config.ts"],"names":[],"mappings":";;;AACA,iEAA8D;AAC9D,yCAAsC;AACtC,6CAA0C;AAEnC,KAAK,UAAU,uBAAuB,CAC3C,MAAsB,EACtB,KAAY;IAEZ,eAAM,CAAC,KAAK,CAAC,2BAA2B,CAAC,CAAC;IAC1C,IAAI,IAAI,GAAG,2JAA2J,CAAC;IACvK,IAAI,KAAK,CAAC,UAAU,EAAE;QACpB,IAAI,IAAI,WAAW,KAAK,CAAC,UAAU,MAAM,CAAC;KAC3C;IACD,IAAI,IAAI,eAAe,KAAK,CAAC,eAAe,IAAI,CAAC;IACjD,IAAI,KAAK,CAAC,iBAAiB,EAAE;QAC3B,IAAI,IAAI,cAAc,KAAK,CAAC,iBAAiB,MAAM,CAAC;KACrD;IACD,MAAM,EAAE,GAAG,MAAM,mBAAQ,CAAC,WAAW,CAAC,MAAM,CAAC,gBAAgB,CAAC,CAAC;IAC/D,IAAI,CAAA,EAAE,aAAF,EAAE,uBAAF,EAAE,CAAE,KAAK,MAAK,6BAAa,EAAE;QAC/B,eAAM,CAAC,KAAK,CAAC,iDAAiD,CAAC,CAAC;QAChE,IAAI,GAAG,qDAAqD,IAAI,EAAE,CAAC;QACnE,IAAI,IAAI,+JAA+J,CAAC;QACxK,IAAI,MAAM,CAAC,MAAM,EAAE;YACjB,eAAM,CAAC,IAAI,CAAC,6BAA6B,EAAE,CAAC,MAAM,EAAE,CAAC,CAAC;SACvD;aAAM;YACL,MAAM,mBAAQ,CAAC,QAAQ,CAAC,EAAE,CAAC,MAAM,EAAE,MAAM,CAAC,iBAAiB,EAAE,IAAI,CAAC,CAAC;SACpE;KACF;SAAM,IAAI,MAAM,CAAC,MAAM,EAAE;QACxB,eAAM,CAAC,IAAI,CAAC,0CAA0C,CAAC,CAAC;KACzD;SAAM;QACL,MAAM,IAAI,GAAG,KAAK,CAAC;QACnB,MAAM,YAAY,GAAG,MAAM,CAAC,uBAAuB,CAAC;QACpD,MAAM,GAAG,GAAG,MAAM,mBAAQ,CAAC,WAAW,CAAC;YACrC,KAAK,EAAE,6CAA6C;YACpD,IAAI;YACJ,IAAI;YACJ,YAAY,EAAE,YAAY;SAC3B,CAAC,CAAC;QACH,IAAI,GAAG,KAAK,SAAS,EAAE;YACrB,eAAM,CAAC,IAAI,CAAC,EAAE,WAAW,EAAE,KAAK,EAAE,GAAG,EAAE,EAAE,gBAAgB,CAAC,CAAC;SAC5D;KACF;AACH,CAAC;AAtCD,0DAsCC","sourcesContent":["import { RenovateConfig } from '../../config';\nimport { PR_STATE_OPEN } from '../../constants/pull-requests';\nimport { logger } from '../../logger';\nimport { platform } from '../../platform';\n\nexport async function raiseConfigWarningIssue(\n  config: RenovateConfig,\n  error: Error\n): Promise<void> {\n  logger.debug('raiseConfigWarningIssue()');\n  let body = `There is an error with this repository's Renovate configuration that needs to be fixed. As a precaution, Renovate will stop PRs until it is resolved.\\n\\n`;\n  if (error.configFile) {\n    body += `File: \\`${error.configFile}\\`\\n`;\n  }\n  body += `Error type: ${error.validationError}\\n`;\n  if (error.validationMessage) {\n    body += `Message: \\`${error.validationMessage}\\`\\n`;\n  }\n  const pr = await platform.getBranchPr(config.onboardingBranch);\n  if (pr?.state === PR_STATE_OPEN) {\n    logger.debug('Updating onboarding PR with config error notice');\n    body = `## Action Required: Fix Renovate Configuration\\n\\n${body}`;\n    body += `\\n\\nOnce you have resolved this problem (in this onboarding branch), Renovate will return to providing you with a preview of your repository's configuration.`;\n    if (config.dryRun) {\n      logger.info(`DRY-RUN: Would update PR #${pr.number}`);\n    } else {\n      await platform.updatePr(pr.number, config.onboardingPrTitle, body);\n    }\n  } else if (config.dryRun) {\n    logger.info('DRY-RUN: Would ensure config error issue');\n  } else {\n    const once = false;\n    const shouldReopen = config.configWarningReuseIssue;\n    const res = await platform.ensureIssue({\n      title: `Action Required: Fix Renovate Configuration`,\n      body,\n      once,\n      shouldReOpen: shouldReopen,\n    });\n    if (res === 'created') {\n      logger.warn({ configError: error, res }, 'Config Warning');\n    }\n  }\n}\n"]}