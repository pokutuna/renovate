{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../lib/util/template/index.ts"],"names":[],"mappings":"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","sourcesContent":["import is from '@sindresorhus/is';\nimport * as handlebars from 'handlebars';\nimport { logger } from '../../logger';\nimport { clone } from '../clone';\n\nhandlebars.registerHelper('encodeURIComponent', encodeURIComponent);\n\n// istanbul ignore next\nhandlebars.registerHelper('replace', (find, replace, context) => {\n  return context.replace(new RegExp(find, 'g'), replace);\n});\n\nexport const exposedConfigOptions = [\n  'branchName',\n  'branchPrefix',\n  'branchTopic',\n  'commitMessage',\n  'commitMessageAction',\n  'commitMessageExtra',\n  'commitMessagePrefix',\n  'commitMessageSuffix',\n  'commitMessageTopic',\n  'group',\n  'groupSlug',\n  'groupName',\n  'managerBranchPrefix',\n  'prBodyColumns',\n  'prBodyDefinitions',\n  'prBodyNotes',\n  'prTitle',\n];\n\nexport const allowedFields = {\n  baseDir: 'The full directory with path that the dependency has been found in',\n  body: 'The body of the release notes',\n  currentValue: 'The extracted current value of the dependency being updated',\n  currentVersion: 'The current version that is being updated',\n  datasource: 'The datasource used to look up the upgrade',\n  depName: 'The name of the dependency being updated',\n  depNameLinked:\n    'The dependency name already linked to its home page using markdown',\n  depNameSanitized:\n    'The depName field sanitized for use in branches after removing spaces and special characters',\n  depNameShort: 'Shortened depName',\n  depType: 'The dependency type (if extracted - manager-dependent)',\n  displayFrom: 'The current value, formatted for display',\n  displayTo: 'The to value, formatted for display',\n  fromVersion:\n    'The version that would be currently installed. For example, if currentValue is ^3.0.0 then currentVersion might be 3.1.0.',\n  hasReleaseNotes: 'true if the upgrade has release notes',\n  isLockfileUpdate: 'true if the branch is a lock file update',\n  isMajor: 'true if the upgrade is major',\n  isPatch: 'true if the upgrade is a patch upgrade',\n  isRange: 'true if the new value is a range',\n  isSingleVersion:\n    'true if the upgrade is to a single version rather than a range',\n  logJSON: 'ChangeLogResult object for the upgrade',\n  lookupName: 'The full name that was used to look up the dependency.',\n  newDigest: 'The new digest value',\n  newDigestShort:\n    'A shorted version of newDigest, for use when the full digest is too long to be conveniently displayed',\n  newMajor:\n    'The major version of the new version. e.g. \"3\" if the new version if \"3.1.0\"',\n  newMinor:\n    'The minor version of the new version. e.g. \"1\" if the new version if \"3.1.0\"',\n  newValue:\n    'The new value in the upgrade. Can be a range or version e.g. \"^3.0.0\" or \"3.1.0\"',\n  newVersion: 'The new version in the upgrade.',\n  packageFile: 'The filename that the dependency was found in',\n  parentDir:\n    'The name of the directory that the dependency was found in, without full path',\n  platform: 'VCS platform in use, e.g. \"github\", \"gitlab\", etc.',\n  project: 'ChangeLogProject object',\n  recreateClosed: 'If true, this PR will be recreated if closed',\n  references: 'A list of references for the upgrade',\n  releases: 'An array of releases for an upgrade',\n  releaseNotes: 'A ChangeLogNotes object for the release',\n  repository: 'The current repository',\n  toVersion: 'The new version in the upgrade, e.g. \"3.1.0\"',\n  updateType: 'One of digest, pin, rollback, patch, minor, major',\n  upgrades: 'An array of upgrade objects in the branch',\n  url: 'The url of the release notes',\n  version: 'The version number of the changelog',\n  versions: 'An array of ChangeLogRelease objects in the upgrade',\n};\n\nfunction getFilteredObject(input: any): any {\n  const obj = clone(input);\n  const res = {};\n  const allAllowed = [\n    ...Object.keys(allowedFields),\n    ...exposedConfigOptions,\n  ].sort();\n  for (const field of allAllowed) {\n    const value = obj[field];\n    if (is.array(value)) {\n      res[field] = value.map((element) => getFilteredObject(element));\n    } else if (is.object(value)) {\n      res[field] = getFilteredObject(value);\n    } else if (!is.undefined(value)) {\n      res[field] = value;\n    }\n  }\n  return res;\n}\n\nexport function compile(\n  template: string,\n  input: any,\n  filterFields = true\n): string {\n  const filteredInput = filterFields ? getFilteredObject(input) : input;\n  logger.trace({ template, filteredInput }, 'Compiling template');\n  return handlebars.compile(template)(input);\n}\n"]}